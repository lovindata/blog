
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../03/17/image-super-resolution-dat-dual-aggregation-transformer-the-new-goat-for-pythonistas-/">
      
      
        <link rel="next" href="../../../06/22/mastering-spark-on-k8s--and-why-i-dumped--kubeflow-spark-operator-formerly-googles-spark-operator/">
      
      
      <link rel="icon" href="../../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Introducing TARP Stack ‚õ∫ ‚Äì Tapir, React and PostgreSQL - LovinData - Simplified Full Stack Data Engineering</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-ZZ86YMNTY8"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-ZZ86YMNTY8",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-ZZ86YMNTY8",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-is-tarp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="LovinData - Simplified Full Stack Data Engineering" class="md-header__button md-logo" aria-label="LovinData - Simplified Full Stack Data Engineering" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LovinData - Simplified Full Stack Data Engineering
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Introducing TARP Stack ‚õ∫ ‚Äì Tapir, React and PostgreSQL
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label=""  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label=""  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  Latest posts

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../archive/2025/" class="md-tabs__link">
          
  
  Archive

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../category/backend/" class="md-tabs__link">
          
  
  Categories

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="LovinData - Simplified Full Stack Data Engineering" class="md-nav__button md-logo" aria-label="LovinData - Simplified Full Stack Data Engineering" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    LovinData - Simplified Full Stack Data Engineering
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Latest posts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2025
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/backend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/data-engineering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Engineering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/frontend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frontend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/scala/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scala
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/typescript/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TypeScript
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-tarp" class="md-nav__link">
    <span class="md-ellipsis">
      ü§î What is TARP?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-environment" class="md-nav__link">
    <span class="md-ellipsis">
      üë®‚Äçüíª Development Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üë®‚Äçüíª Development Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database" class="md-nav__link">
    <span class="md-ellipsis">
      Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    <span class="md-ellipsis">
      Backend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frontend" class="md-nav__link">
    <span class="md-ellipsis">
      Frontend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-your-application" class="md-nav__link">
    <span class="md-ellipsis">
      üèóÔ∏è Building Your Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üèóÔ∏è Building Your Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database_1" class="md-nav__link">
    <span class="md-ellipsis">
      Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend_1" class="md-nav__link">
    <span class="md-ellipsis">
      Backend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frontend_1" class="md-nav__link">
    <span class="md-ellipsis">
      Frontend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrapping-up-for-production" class="md-nav__link">
    <span class="md-ellipsis">
      üéÅ Wrapping Up For Production
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéÅ Wrapping Up For Production">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serving-react-via-tapir" class="md-nav__link">
    <span class="md-ellipsis">
      Serving React via Tapir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimized-docker-build" class="md-nav__link">
    <span class="md-ellipsis">
      Optimized Docker Build
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-stack-developer-reached" class="md-nav__link">
    <span class="md-ellipsis">
      üåü Full-Stack Developer Reached!
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2024-04-18 00:00:00+00:00" class="md-ellipsis">April 18, 2024</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../../category/typescript/">TypeScript</a>, 
                              <a href="../../../../category/scala/">Scala</a>, 
                              <a href="../../../../category/docker/">Docker</a>, 
                              <a href="../../../../category/frontend/">Frontend</a>, 
                              <a href="../../../../category/backend/">Backend</a>, 
                              <a href="../../../../category/devops/">DevOps</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              24 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        


  <h1>Introducing TARP Stack ‚õ∫ ‚Äì Tapir, React and PostgreSQL</h1>

<p>I landed my first job as a Data Engineer using <a href="https://www.scala-lang.org/">Scala</a>. It's been over 3 years now, approaching 4 years. The more experience you gain, the more you want to spread your wings ü™Ω to tackle even bigger and more complex projects than just data pipelines, like developing <strong>full-stack web data applications</strong>. But, I really do not want to dissipate myself too much on all the programming languages, libraries, or frameworks out there üò£. These are just tools. What's important is how efficiently you can use them for the product or feature you envisioned ü¶Ñüåà. Sooo! For me, it's currently the <strong>TARP</strong> tech stack!</p>
<!-- more -->

<p><a class="glightbox" href="../../../../2/image.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="TARP" src="../../../../2/image.png" /></a></p>
<h2 id="what-is-tarp">ü§î What is TARP?</h2>
<p><strong>TARP</strong> stands for <strong>Tapir</strong>, <strong>React</strong> and <strong>PostgreSQL</strong>. In detail:</p>
<ul>
<li>ü¶õ <a href="https://tapir.softwaremill.com/en/latest/"><strong>Tapir</strong></a>: For the backend, it's a lightweight library similar to <a href="https://fastapi.tiangolo.com/">FastAPI</a>, designed for building endpoints and providing free SwaggerUI docs.</li>
<li>‚öõÔ∏è <a href="https://react.dev/"><strong>React</strong></a>: For the frontend, it's the most popular framework with the largest community, according to the <a href="https://survey.stackoverflow.co/2023/#section-admired-and-desired-web-frameworks-and-technologies">Stack Overflow Developer Survey 2023</a>.</li>
<li>üêò <a href="https://www.postgresql.org/"><strong>PostgreSQL</strong></a>: Chosen for the database due to its popularity and strong community support, as indicated by the <a href="https://survey.stackoverflow.co/2023/#section-admired-and-desired-web-frameworks-and-technologies">Stack Overflow Developer Survey 2023</a>.</li>
</ul>
<p>I'm really excited üòÑ to demonstrate how productive you can be with this tech stack. Let's start building, shall we! By the way, do you know what "TARP" stands for? ü§£ A tarp functions as a waterproof protective cover, for example, when building tents ‚õ∫.</p>
<h2 id="development-environment">üë®‚Äçüíª Development Environment</h2>
<p>For your coding environment, I highly recommend using <a href="https://code.visualstudio.com/">VSCode</a>. It has amazing support for <a href="https://www.typescriptlang.org/">TypeScript</a> and <a href="https://www.docker.com/">Docker</a> with various extensions. Scala development can also be done on VSCode using the <a href="https://scalameta.org/metals/docs/editors/vscode/">Metals</a> extension. I used to develop on IntelliJ, but got tired of switching between VSCode and <a href="https://www.jetbrains.com/idea/">IntelliJ</a> üò´. So yeah, if you have to handle more than just Scala code, just go with VSCode üòã.</p>
<p>Let's create 3 folders: <code>./devops</code>, <code>./backend</code>, <code>./frontend</code>, and also the <code>./vscode.code-workspace</code> file.</p>
<div class="language-json highlight"><span class="filename">./vscode.code-workspace</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">&quot;folders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;backend&quot;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;devops&quot;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;frontend&quot;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">}</span>
</span></code></pre></div>
<p>You've just organized your project into <a href="https://code.visualstudio.com/docs/editor/workspaces">VSCode workspaces</a>. This is a way to instruct VSCode to treat each folder as an independent workspace, allowing you to <strong>work on them simultaneously within a single VSCode window</strong>. When you open the <code>./vscode.code-workspace</code> file using VSCode, it will automatically detect three workspaces.</p>
<figure>
  <a class="glightbox" href="../../../../2/image-4.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="VSCode workspaces" src="../../../../2/image-4.png" /></a>
  <figcaption>VSCode workspaces</figcaption>
</figure>
<p>The goal of this section is to establish a well-structured VSCode folder for your FullStack application as shown below üëá.</p>
<figure>
  <a class="glightbox" href="../../../../2/image-1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Folder structure" src="../../../../2/image-1.png" /></a>
  <figcaption>Folder structure</figcaption>
</figure>
<p>Let's start! üò§</p>
<h3 id="database">Database</h3>
<p>The goal here is to set up a local PostgreSQL database and be able to explore it with suitable tools. This will be achieved using a <a href="https://hub.docker.com/_/postgres">PostgreSQL Docker container</a> and the SQLTools VSCode extension. Please install:</p>
<ul>
<li>üê≥ <a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a>: For setting up a local PostgreSQL database.</li>
<li>‚ûï <a href="https://code.visualstudio.com/docs/containers/overview">Docker</a> VSCode extension: To execute Docker commands directly via the VSCode UI.</li>
<li>üîé <a href="https://marketplace.visualstudio.com/items?itemName=mtxr.sqltools">SQLTools</a> and <a href="https://marketplace.visualstudio.com/items?itemName=mtxr.sqltools-driver-pg">SQLTools PostgreSQL/Cockroach Driver</a> VSCode extensions: For viewing the local PostgreSQL database.</li>
</ul>
<p>Let's create a <a href="https://docs.docker.com/compose/gettingstarted/">Docker Compose</a> file, which is simply a YAML file with specific syntax, to run the local PostgreSQL database.</p>
<div class="language-yaml highlight"><span class="filename">./devops/dev-local/docker-compose.yml</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">database</span><span class="p">:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:16.2</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD=tarp</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_USER=tarp</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_DB=tarp</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data:/var/lib/postgresql/data</span><span class="w"> </span><span class="c1"># Optional, but can keep our database data persistent on the host disk.</span>
</span></code></pre></div>
<p>You are now all set to run it:</p>
<ul>
<li>Right click on <code>./devops/dev-local/docker-compose.yml</code></li>
<li>Click on <code>Compose Up</code></li>
</ul>
<p>After a little while, if you go to the Docker Desktop application, you should see your local PostgreSQL database running üòÉ!</p>
<figure>
  <a class="glightbox" href="../../../../2/image-2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="PostgreSQL container" src="../../../../2/image-2.png" /></a>
  <figcaption>PostgreSQL container</figcaption>
</figure>
<p>To ensure the local PostgreSQL setup is correct, you can explore it using the SQLTools extension in VSCode. To do this, add a new connection in SQLTools:</p>
<ul>
<li><code>CTRL + SHIFT + P</code></li>
<li>Click on <code>SQLTools Management: Add New Connection</code></li>
<li>Follow the instructions and fill in the fields according to how the PostgreSQL container is configured in <code>./devops/dev-local/docker-compose.yml</code></li>
</ul>
<figure>
  <a class="glightbox" href="../../../../2/image-3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="PostgreSQL view using SQLTools" src="../../../../2/image-3.png" /></a>
  <figcaption>PostgreSQL view using SQLTools</figcaption>
</figure>
<p>If you've reached this point, your local PostgreSQL database is now all set for development! üëç</p>
<h3 id="backend">Backend</h3>
<p>Let's set up our Scala project! First, install:</p>
<ul>
<li>‚òïÔ∏è <a href="https://adoptium.net/temurin/releases/?version=17">Java 17</a>: Because Scala runs on top of the JVM.</li>
<li>‚öôÔ∏è <a href="https://scalameta.org/metals/docs/editors/vscode/">Metals</a> VSCode extension: For supporting us during implementation in Scala.</li>
</ul>
<p>Then, two files must be defined:</p>
<ul>
<li><code>./backend/project/build.properties</code>: For specifying the <a href="https://www.scala-sbt.org/">SBT</a> (the Scala dependencies manager) version.</li>
</ul>
<div class="language-properties highlight"><span class="filename">./backend/project/build.properties</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># https://github.com/sbt/sbt (look tags for version)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="na">sbt.version</span><span class="o">=</span><span class="s">1.9.9</span>
</span></code></pre></div>
<ul>
<li><code>./backend/build.sbt</code>: For project metadata and dependencies.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/build.sbt</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="cm">/**</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="cm"> * Project configurations.</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="cm"> */</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="nc">ThisBuild</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">scalaVersion</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;2.13.13&quot;</span><span class="w"> </span><span class="c1">// https://www.scala-lang.org/download/all.html</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="k">lazy</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">project</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)).</span><span class="n">settings</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;backend&quot;</span><span class="p">)</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="cm">/**</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="cm"> * Dev dependencies.</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="cm"> */</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="c1">// Cats &amp; Scala extensions</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="c1">// https://mvnrepository.com/artifact/org.typelevel/cats-effect</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.typelevel&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;cats-effect&quot;</span><span class="w">        </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;3.5.4&quot;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="c1">// https://github.com/oleg-py/better-monadic-for (look tags for version)</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="n">addCompilerPlugin</span><span class="p">(</span><span class="s">&quot;com.olegpy&quot;</span><span class="w">         </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;better-monadic-for&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.3.1&quot;</span><span class="p">)</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="c1">// https://mvnrepository.com/artifact/dev.optics/monocle-core</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;dev.optics&quot;</span><span class="w">    </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;monocle-core&quot;</span><span class="w">       </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;3.2.0&quot;</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="c1">// https://mvnrepository.com/artifact/dev.optics/monocle-macro</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;dev.optics&quot;</span><span class="w">    </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;monocle-macro&quot;</span><span class="w">      </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;3.2.0&quot;</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="c1">// Tapir</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="c1">// https://mvnrepository.com/artifact/com.softwaremill.sttp.tapir/tapir-http4s-server</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;com.softwaremill.sttp.tapir&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;tapir-http4s-server&quot;</span><span class="w">     </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.10.4&quot;</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="c1">// https://mvnrepository.com/artifact/com.softwaremill.sttp.tapir/tapir-json-circe</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;com.softwaremill.sttp.tapir&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;tapir-json-circe&quot;</span><span class="w">        </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.10.4&quot;</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="c1">// https://mvnrepository.com/artifact/com.softwaremill.sttp.tapir/tapir-swagger-ui-bundle</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;com.softwaremill.sttp.tapir&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;tapir-swagger-ui-bundle&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.10.4&quot;</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="c1">// Http4s</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="c1">// https://mvnrepository.com/artifact/org.http4s/http4s-ember-server</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.http4s&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;http4s-ember-server&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.23.26&quot;</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="c1">// https://mvnrepository.com/artifact/org.http4s/http4s-circe</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.http4s&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;http4s-circe&quot;</span><span class="w">        </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.23.26&quot;</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="c1">// https://mvnrepository.com/artifact/org.http4s/http4s-dsl</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.http4s&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;http4s-dsl&quot;</span><span class="w">          </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.23.26&quot;</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="c1">// https://mvnrepository.com/artifact/org.http4s/http4s-ember-client</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.http4s&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;http4s-ember-client&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.23.26&quot;</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="c1">// Log4j2</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="c1">// https://mvnrepository.com/artifact/org.typelevel/log4cats-core</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.typelevel&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;log4cats-core&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;2.6.0&quot;</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="c1">// https://mvnrepository.com/artifact/org.slf4j/slf4j-simple</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.slf4j&quot;</span><span class="w">      </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;slf4j-simple&quot;</span><span class="w">  </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;2.0.13&quot;</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="c1">// Circe</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="c1">// https://mvnrepository.com/artifact/io.circe/circe-parser</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;io.circe&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;circe-parser&quot;</span><span class="w">         </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.14.6&quot;</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="c1">// https://mvnrepository.com/artifact/io.circe/circe-generic</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;io.circe&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;circe-generic&quot;</span><span class="w">        </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.14.6&quot;</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="c1">// https://mvnrepository.com/artifact/io.circe/circe-generic-extras</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;io.circe&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;circe-generic-extras&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.14.3&quot;</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a><span class="c1">// https://mvnrepository.com/artifact/io.circe/circe-literal</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;io.circe&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;circe-literal&quot;</span><span class="w">        </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.14.6&quot;</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a><span class="c1">// Doobie</span>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a><span class="c1">// https://mvnrepository.com/artifact/org.tpolecat/doobie-core</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.tpolecat&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;doobie-core&quot;</span><span class="w">     </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.0.0-RC5&quot;</span>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a><span class="c1">// https://mvnrepository.com/artifact/org.tpolecat/doobie-postgres</span>
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.tpolecat&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;doobie-postgres&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.0.0-RC5&quot;</span>
</span><span id="__span-3-59"><a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a><span class="c1">// https://mvnrepository.com/artifact/org.tpolecat/doobie-hikari</span>
</span><span id="__span-3-60"><a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.tpolecat&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;doobie-hikari&quot;</span><span class="w">   </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.0.0-RC5&quot;</span>
</span><span id="__span-3-61"><a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>
</span><span id="__span-3-62"><a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a><span class="c1">// Flyway</span>
</span><span id="__span-3-63"><a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a><span class="c1">// https://mvnrepository.com/artifact/org.flywaydb/flyway-core</span>
</span><span id="__span-3-64"><a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.flywaydb&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;flyway-core&quot;</span><span class="w">                </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;10.11.1&quot;</span>
</span><span id="__span-3-65"><a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a><span class="c1">// https://mvnrepository.com/artifact/org.flywaydb/flyway-database-postgresql</span>
</span><span id="__span-3-66"><a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.flywaydb&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;flyway-database-postgresql&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;10.11.1&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;runtime&quot;</span>
</span><span id="__span-3-67"><a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>
</span><span id="__span-3-68"><a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a><span class="cm">/**</span>
</span><span id="__span-3-69"><a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a><span class="cm"> * Test dependencies.</span>
</span><span id="__span-3-70"><a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a><span class="cm"> */</span>
</span><span id="__span-3-71"><a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a><span class="c1">// https://mvnrepository.com/artifact/org.scalatest/scalatest</span>
</span><span id="__span-3-72"><a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.scalatest&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;scalatest&quot;</span><span class="w">          </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;3.2.18&quot;</span><span class="w">  </span><span class="o">%</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-3-73"><a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a><span class="c1">// https://mvnrepository.com/artifact/org.mockito/mockito-scala</span>
</span><span id="__span-3-74"><a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.mockito&quot;</span><span class="w">   </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;mockito-scala&quot;</span><span class="w">      </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.17.31&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-3-75"><a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a><span class="c1">// https://mvnrepository.com/artifact/org.mockito/mockito-scala-cats</span>
</span><span id="__span-3-76"><a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a><span class="n">libraryDependencies</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;org.mockito&quot;</span><span class="w">   </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;mockito-scala-cats&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.17.31&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nc">Test</span>
</span></code></pre></div>
<p>To instruct Metals to set up the Scala environment and install the dependencies:</p>
<ul>
<li><code>CTRL + SHIFT + P</code></li>
<li><code>Metals: Import build</code></li>
</ul>
<p>Then, go to the Metals extension view to confirm it's correctly set up üòé:</p>
<figure>
  <a class="glightbox" href="../../../../2/image-5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Metals extension" src="../../../../2/image-5.png" /></a>
  <figcaption>Metals extension</figcaption>
</figure>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a href="https://scalameta.org/metals/blog/2023/07/17/workspace-folders">Metals uses VSCode workspace setup</a> to detect Scala projects. So, it's important to have correctly set up VSCode workspaces as explained previously!</p>
</div>
<p>We're also going to initialize the backend API and database driver.</p>
<ul>
<li>First, set up the <strong>environement variables üîë</strong>.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/src/main/scala/confs/EnvConf.scala</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">package</span><span class="w"> </span><span class="n">confs</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EnvConf</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">allEnvVar</span><span class="p">:</span><span class="w"> </span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">env</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">devMode</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="n">allEnvVar</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s">&quot;TARP_DEV_MODE&quot;</span><span class="p">,</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">                        </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="c1">// To handle different behaviors in dev and prod environments</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">port</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allEnvVar</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s">&quot;TARP_PORT&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;8080&quot;</span><span class="p">).</span><span class="n">toInt</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">postgresIp</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">allEnvVar</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s">&quot;TARP_POSTGRES_IP&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">postgresPort</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">allEnvVar</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s">&quot;TARP_POSTGRES_PORT&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;5432&quot;</span><span class="p">).</span><span class="n">toInt</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">postgresDb</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">allEnvVar</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s">&quot;TARP_POSTGRES_DB&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tarp&quot;</span><span class="p">)</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">postgresUser</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">allEnvVar</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s">&quot;TARP_POSTGRES_USER&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tarp&quot;</span><span class="p">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">postgresPassword</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allEnvVar</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s">&quot;TARP_POSTGRES_PASSWORD&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tarp&quot;</span><span class="p">)</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">postgresSchema</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">allEnvVar</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="s">&quot;TARP_POSTGRES_SCHEMA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tarp&quot;</span><span class="p">)</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="p">}</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="k">object</span><span class="w"> </span><span class="nc">EnvConf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">implicit</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">impl</span><span class="p">:</span><span class="w"> </span><span class="nc">EnvConf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">EnvConf</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Second, integrate ü¶õ Tapir using <a href="https://http4s.org/v0.23/docs/quickstart.html">http4s</a> under the hood.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/src/main/scala/confs/ApiConf.scala</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">package</span><span class="w"> </span><span class="n">confs</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IO</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">comcast</span><span class="p">.</span><span class="nn">ip4s</span><span class="p">.</span><span class="nc">IpLiteralSyntax</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">comcast</span><span class="p">.</span><span class="nn">ip4s</span><span class="p">.</span><span class="nc">Port</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">ember</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nc">EmberServerBuilder</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">middleware</span><span class="p">.{</span><span class="nc">Logger</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">LoggerMiddleware</span><span class="p">}</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">middleware</span><span class="p">.</span><span class="nc">CORS</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nc">Logger</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nn">slf4j</span><span class="p">.</span><span class="nc">Slf4jLogger</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nn">syntax</span><span class="p">.</span><span class="nc">LoggerInterpolator</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nc">Http4sServerInterpreter</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">swagger</span><span class="p">.</span><span class="nn">bundle</span><span class="p">.</span><span class="nc">SwaggerInterpreter</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApiConf</span><span class="p">()(</span><span class="k">implicit</span><span class="w"> </span><span class="n">envConf</span><span class="p">:</span><span class="w"> </span><span class="nc">EnvConf</span><span class="p">,</span><span class="w"> </span><span class="n">logger</span><span class="p">:</span><span class="w"> </span><span class="nc">Logger</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Slf4jLogger</span><span class="p">.</span><span class="n">getLogger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="n">port</span><span class="w">      </span><span class="o">&lt;-</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">      </span><span class="nc">IO</span><span class="p">.</span><span class="n">fromOption</span><span class="p">(</span><span class="nc">Port</span><span class="p">.</span><span class="n">fromInt</span><span class="p">(</span><span class="n">envConf</span><span class="p">.</span><span class="n">port</span><span class="p">))(</span><span class="k">new</span><span class="w"> </span><span class="nc">RuntimeException</span><span class="p">(</span><span class="s">s&quot;Not processable port number </span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s">.&quot;</span><span class="p">))</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="n">corsPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CORS</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">withAllowOriginHostCi</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">                   </span><span class="n">envConf</span><span class="p">.</span><span class="n">devMode</span><span class="p">)</span><span class="w"> </span><span class="c1">// Essential for local development setup with an SPA running on a separate port</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="n">_</span><span class="w">         </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">EmberServerBuilder</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">                   </span><span class="p">.</span><span class="n">default</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">                   </span><span class="p">.</span><span class="n">withHost</span><span class="p">(</span><span class="n">ipv4</span><span class="s">&quot;0.0.0.0&quot;</span><span class="p">)</span><span class="w">                    </span><span class="c1">// Accept connections from any available network interface</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">                   </span><span class="p">.</span><span class="n">withPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="w">                             </span><span class="c1">// On a given port</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">                   </span><span class="p">.</span><span class="n">withHttpApp</span><span class="p">(</span><span class="n">corsPolicy</span><span class="p">(</span><span class="n">allRts</span><span class="p">).</span><span class="n">orNotFound</span><span class="p">)</span><span class="w"> </span><span class="c1">// Link all routes to the backend server</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">                   </span><span class="p">.</span><span class="n">build</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">                   </span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="p">.</span><span class="n">never</span><span class="p">)</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">                   </span><span class="p">.</span><span class="n">start</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">                   </span><span class="p">.</span><span class="n">void</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">()</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">docsEpt</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="w">    </span><span class="nc">SwaggerInterpreter</span><span class="p">().</span><span class="n">fromEndpoints</span><span class="p">[</span><span class="nc">IO</span><span class="p">](</span><span class="nc">List</span><span class="p">.</span><span class="n">empty</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Backend ‚Äì TARP Stack ‚õ∫&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1.0&quot;</span><span class="p">)</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">allRts</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">loggerMiddleware</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="w">      </span><span class="nc">LoggerMiddleware</span><span class="p">.</span><span class="n">httpRoutes</span><span class="p">(</span><span class="w">                 </span><span class="c1">// To log incoming requests or outgoing responses from the server</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="w">        </span><span class="n">logHeaders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="w">        </span><span class="n">logBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="w">        </span><span class="n">redactHeadersWhen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">envConf</span><span class="p">.</span><span class="n">devMode</span><span class="p">,</span><span class="w"> </span><span class="c1">// Display header values exclusively during development mode</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="w">        </span><span class="n">logAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Some</span><span class="p">((</span><span class="n">msg</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">info</span><span class="s">&quot;$msg&quot;</span><span class="p">)</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="w">      </span><span class="p">)(</span><span class="n">_</span><span class="p">)</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="w">    </span><span class="n">loggerMiddleware</span><span class="p">(</span><span class="nc">Http4sServerInterpreter</span><span class="p">[</span><span class="nc">IO</span><span class="p">]().</span><span class="n">toRoutes</span><span class="p">(</span><span class="n">docsEpt</span><span class="p">))</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="p">}</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="k">object</span><span class="w"> </span><span class="nc">ApiConf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">implicit</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">impl</span><span class="p">:</span><span class="w"> </span><span class="nc">ApiConf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApiConf</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Lastly, integrate the database driver. Utilize a combination of <a href="https://tpolecat.github.io/doobie/">Doobie</a> for interacting with our database and ‚ôªÔ∏è <a href="https://github.com/flyway/flyway">Flyway</a> to manage the database schema lifecycle changes.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/src/main/scala/confs/DbConf.scala</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">package</span><span class="w"> </span><span class="n">confs</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IO</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">Resource</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">doobie</span><span class="p">.</span><span class="nc">ConnectionIO</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">doobie</span><span class="p">.</span><span class="nn">hikari</span><span class="p">.</span><span class="nc">HikariTransactor</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">import</span><span class="w"> </span><span class="nn">doobie</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">import</span><span class="w"> </span><span class="nn">doobie</span><span class="p">.</span><span class="nn">util</span><span class="p">.</span><span class="nc">ExecutionContexts</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">flywaydb</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="nc">Flyway</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DbConf</span><span class="p">()(</span><span class="k">implicit</span><span class="w"> </span><span class="n">envConf</span><span class="p">:</span><span class="w"> </span><span class="nc">EnvConf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">raiseUnlessDbUp</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">      </span><span class="n">isUp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">run</span><span class="p">(</span><span class="n">sql</span><span class="s">&quot;SELECT 1;&quot;</span><span class="p">.</span><span class="n">query</span><span class="p">[</span><span class="nc">Long</span><span class="p">].</span><span class="n">unique</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">      </span><span class="n">_</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">IO</span><span class="p">.</span><span class="n">raiseUnless</span><span class="p">(</span><span class="n">isUp</span><span class="p">)(</span><span class="k">new</span><span class="w"> </span><span class="nc">RuntimeException</span><span class="p">(</span><span class="s">s&quot;Postgres </span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresDb</span><span class="si">}</span><span class="s"> database is down.&quot;</span><span class="p">))</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">()</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">migrate</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nc">IO</span><span class="p">.</span><span class="n">blocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">      </span><span class="nc">Flyway</span><span class="p">.</span><span class="n">configure</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">        </span><span class="p">.</span><span class="n">dataSource</span><span class="p">(</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">          </span><span class="s">s&quot;jdbc:postgresql://</span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresIp</span><span class="si">}</span><span class="s">:</span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresPort</span><span class="si">}</span><span class="s">/</span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresDb</span><span class="si">}</span><span class="s">?currentSchema=</span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresSchema</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">          </span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresUser</span><span class="p">,</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">          </span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresPassword</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">        </span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">        </span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="s">&quot;flyway&quot;</span><span class="p">)</span><span class="w">                 </span><span class="c1">// ‚ö†Ô∏è &quot;flyway&quot; as migration table history (in &#39;currentSchema&#39; see above)</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">        </span><span class="p">.</span><span class="n">locations</span><span class="p">(</span><span class="s">&quot;conf/DbConf/flyway&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// &quot;.sql&quot; files migration resource path</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">        </span><span class="p">.</span><span class="n">failOnMissingLocations</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">        </span><span class="p">.</span><span class="n">load</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">        </span><span class="p">.</span><span class="n">migrate</span><span class="w">                         </span><span class="c1">// Auto create schema if not exists &amp; Rollback raise exception if failed</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">      </span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raiseUnlessDbUp</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">      </span><span class="n">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">migrate</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">()</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">[</span><span class="nc">A</span><span class="p">](</span><span class="n">sqls</span><span class="p">:</span><span class="w"> </span><span class="nc">ConnectionIO</span><span class="p">[</span><span class="nc">A</span><span class="p">]):</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">A</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transactor</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">sqls</span><span class="p">.</span><span class="n">transact</span><span class="p">[</span><span class="nc">IO</span><span class="p">])</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">transactor</span><span class="p">:</span><span class="w"> </span><span class="nc">Resource</span><span class="p">[</span><span class="nc">IO</span><span class="p">,</span><span class="w"> </span><span class="nc">HikariTransactor</span><span class="p">[</span><span class="nc">IO</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="w">    </span><span class="n">ce</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">ExecutionContexts</span><span class="p">.</span><span class="n">fixedThreadPool</span><span class="p">[</span><span class="nc">IO</span><span class="p">](</span><span class="mi">32</span><span class="p">)</span>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="w">    </span><span class="n">xa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">HikariTransactor</span><span class="p">.</span><span class="n">newHikariTransactor</span><span class="p">[</span><span class="nc">IO</span><span class="p">](</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">            </span><span class="s">&quot;org.postgresql.Driver&quot;</span><span class="p">,</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="w">            </span><span class="s">s&quot;jdbc:postgresql://</span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresIp</span><span class="si">}</span><span class="s">:</span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresPort</span><span class="si">}</span><span class="s">/</span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresDb</span><span class="si">}</span><span class="s">?currentSchema=</span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresSchema</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">            </span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresUser</span><span class="p">,</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="w">            </span><span class="n">envConf</span><span class="p">.</span><span class="n">postgresPassword</span><span class="p">,</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="w">            </span><span class="n">ce</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="w">          </span><span class="p">)</span>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="n">xa</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="p">}</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="k">object</span><span class="w"> </span><span class="nc">DbConf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">implicit</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">impl</span><span class="p">:</span><span class="w"> </span><span class="nc">DbConf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">DbConf</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Finally, create a Main class entry point to enable all these components to run.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/src/main/scala/Main.scala</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IO</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IOApp</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">confs</span><span class="p">.</span><span class="nc">ApiConf</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">confs</span><span class="p">.</span><span class="nc">DbConf</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="k">object</span><span class="w"> </span><span class="nc">Main</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">IOApp</span><span class="p">.</span><span class="nc">Simple</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">DbConf</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">setup</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nc">ApiConf</span><span class="p">.</span><span class="n">impl</span><span class="p">.</span><span class="n">setup</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="p">.</span><span class="n">never</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>In VSCode, after your code has compiled, you should see a <code>Run</code> ‚ñ∂Ô∏è button appear above your <code>./backend/src/main/scala/Main.scala</code> class. Click üëÜ on it, then go to <a href="http://localhost:8080/docs/">http://localhost:8080/docs/</a> to see if it worked!</p>
<figure>
  <a class="glightbox" href="../../../../2/image-6.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="SwaggerUI" src="../../../../2/image-6.png" /></a>
  <figcaption>SwaggerUI</figcaption>
</figure>
<p><a href="https://swagger.io/tools/swagger-ui/">SwaggerUI</a> is accessible for documenting your endpoints for the frontend team. Currently, there are none, but that will change in the second section when we begin building application logic. Let's proceed with setting up the frontend development environment.</p>
<h3 id="frontend">Frontend</h3>
<p>To begin, we need to install <a href="https://nodejs.org/en">Node.js</a>. It's necessary for running <a href="https://www.npmjs.com/">npm</a> commands and installing dependencies. One of the first dependencies we need is a build tool for frontend <a href="https://en.wikipedia.org/wiki/Single-page_application">SPAs</a>. There are quite a few out there, but for me, <a href="https://vitejs.dev/">Vite</a> is the best and fastest when it comes to building SPAs with React. To create a React project using Vite:</p>
<ul>
<li>Look at your VSCode navigation bar at the top &gt; Click on <code>Terminal</code> &gt; Click on <code>frontend</code> &gt; A terminal for <code>./frontend</code> should appear</li>
<li>Then run <code>npm init vite@latest</code> and follow the instructions</li>
</ul>
<p>For the instructions, make sure to:</p>
<ul>
<li>Create your project at <code>./frontend</code></li>
<li>Use <code>React</code> and not be baited by <a href="https://preactjs.com/"><code>Preact</code></a> üòÇ</li>
<li>Select <a href="https://swc.rs/"><code>TypeScript + SWC</code></a> for TypeScript compilation, which includes a <a href="https://www.rust-lang.org/">Rust-based</a> engine for SPEEEEEEEED! üí®</li>
</ul>
<p>Files should magically appear in your <code>./frontend</code> VSCode workspace! üåà Now, let's install the dependencies defined in <code>./frontend/package.json</code>. To do that, run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>npm<span class="w"> </span>install
</span></code></pre></div>
<p>You should see a folder <code>./node_modules</code> appear, where all the dependencies will now reside. From this point, you can run the predefined application that Vite gave you when we initialized the project:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>npm<span class="w"> </span>run<span class="w"> </span>dev
</span></code></pre></div>
<p>Then, navigate to <a href="http://localhost:5173/">http://localhost:5173/</a>.</p>
<figure>
  <a class="glightbox" href="../../../../2/image-7.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="&quot;Vite + React&quot; page" src="../../../../2/image-7.png" /></a>
  <figcaption>"Vite + React" page</figcaption>
</figure>
<p>Congratulations, your frontend development environment has been successfully set up ‚úÖ. The development team behind Vite has truly done an amazing job to make it so easy! üòå</p>
<h2 id="building-your-application">üèóÔ∏è Building Your Application</h2>
<p>From the previous section, you should have these three services running locally:</p>
<ul>
<li>ü¶õ A Tapir backend with a database driver ready for interaction ‚ñ∂Ô∏è</li>
<li>‚öõÔ∏è A React frontend serving the UI üíÅ‚Äç‚ôÇÔ∏è</li>
<li>üêò A PostgreSQL database up and running ü´°</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It's possible that you don't have exactly the same files in each folder <code>./backend</code>, <code>./frontend</code>, and <code>./devops</code> as presented in the <code>Folder structure</code> figure. This may be due to updates that occurred in the libraries or tools used, or simply because I did not take the time to present all non-mandatory details üßê. So, if you would like to have exactly the same, don't hesitate to check directly on <a href="https://github.com/lovindata/blog/tree/main/assets/posts/2">GitHub</a>!</p>
</div>
<p>Now, the mission will be to implement some application logic. Nothing overly complicated, but <strong>comprehensive</strong>. This must involve:</p>
<ul>
<li>üêòü§ùü¶õ <strong>Interaction between PostgreSQL and the Tapir backend server</strong></li>
<li>ü¶õü§ù‚öõÔ∏è <strong>Interaction between the Tapir backend server and the React frontend</strong></li>
</ul>
<p>What about making our last button persistent? ü§î You know, this one:</p>
<figure>
  <a class="glightbox" href="../../../../2/image-8.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Button clicked 1000 times" src="../../../../2/image-8.png" /></a>
  <figcaption>Button clicked 1000 times</figcaption>
</figure>
<p>Currently, I lose all my hard work üò© if I refresh the page üîÉ. BUUUUUUUUT, if it's persisted in the database, it will still be there even if I refresh the page üòè!</p>
<figure>
  <a class="glightbox" href="../../../../2/image-9.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Frontend, Backend and Database interactions" src="../../../../2/image-9.png" /></a>
  <figcaption>Frontend, Backend and Database interactions</figcaption>
</figure>
<p>So let's do it! üí™ To be clear, saving a button state in the database makes zero sense üòÇ!</p>
<h3 id="database_1">Database</h3>
<p>States are stored in PostgreSQL using tables, so we need to create a table for them. Since there is only one button state, it will consist of a single row with an ID and a count value.</p>
<p>Do you recall <strong>Flyway</strong> from when we worked on the backend? If you check your SQLTools view, you should see a schema named <code>tarp</code>. This schema was created when the Scala backend was launched, specifically when the <code>_.migrate</code> operation completed.</p>
<p>The <code>tarp</code> schema is currently managed by Flyway. Our goal here is to <strong>instruct Flyway to create our counter table during the <code>_.migrate</code> operation</strong>. To do that, simply create the following SQL file:</p>
<div class="language-sql highlight"><span class="filename">./backend/src/main/resources/conf/DbConf/flyway/V0__counter_create_table.sql</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">tarp</span><span class="p">.</span><span class="n">counter</span><span class="p">(</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">BIGSERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="k">count</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">);</span>
</span></code></pre></div>
<p>If you relaunch your backend application, you should see some logs indicating successful migration and a <strong>new table in your SQLTools view</strong>.</p>
<figure>
  <a class="glightbox" href="../../../../2/image-10.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Flyway schema migration" src="../../../../2/image-10.png" /></a>
  <figcaption>Flyway schema migration</figcaption>
</figure>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Database schema changes are an inevitable part of <strong>continuous application development</strong>. As your application evolves, you may need to add or remove columns from existing tables. These changes are closely tied to your backend application logic. One way to address this challenge is to perform <strong>database schema migration upon application launch</strong> and manage all <strong>changes as closely as possible to your backend code</strong>. That's why you see the <strong>*.sql files defined in our backend folder</strong>. This is just one approach; I encourage you to explore other possible solutions.</p>
</div>
<h3 id="backend_1">Backend</h3>
<p>Backend development time! üòç In order to make our counter application work:</p>
<ul>
<li>First, let's define the <strong>application object</strong>.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/src/main/modules/counter/CounterMod.scala</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">package</span><span class="w"> </span><span class="nn">modules</span><span class="p">.</span><span class="n">counter</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">monocle</span><span class="p">.</span><span class="nn">syntax</span><span class="p">.</span><span class="nn">all</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CounterMod</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nc">Long</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">:</span><span class="w"> </span><span class="nc">Long</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">addOne</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterMod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">this</span><span class="p">.</span><span class="n">focus</span><span class="p">(</span><span class="n">_</span><span class="p">.</span><span class="n">count</span><span class="p">).</span><span class="n">modify</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Second, the <strong>application logic and persistence</strong>.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/src/main/modules/counter/CounterSvc.scala</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">package</span><span class="w"> </span><span class="nn">modules</span><span class="p">.</span><span class="n">counter</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IO</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">confs</span><span class="p">.</span><span class="nc">DbConf</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">doobie</span><span class="p">.</span><span class="nc">ConnectionIO</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="k">final</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CounterSvc</span><span class="p">()(</span><span class="k">implicit</span><span class="w"> </span><span class="n">dbConf</span><span class="p">:</span><span class="w"> </span><span class="nc">DbConf</span><span class="p">,</span><span class="w"> </span><span class="n">counterRep</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterRep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">getOrCreate</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Long</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbConf</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">counterRep</span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span><span class="p">.</span><span class="n">count</span><span class="p">))</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">addOne</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Long</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbConf</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="k">for</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Runs atomically within the same database transaction</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span><span class="n">counter</span><span class="w">       </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counterRep</span><span class="p">.</span><span class="n">getOrCreate</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">    </span><span class="n">counterUpdated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">addOne</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">    </span><span class="n">_</span><span class="w">             </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counterRep</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">counterUpdated</span><span class="p">)</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">    </span><span class="n">count</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">counterUpdated</span><span class="p">.</span><span class="n">count</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="p">}</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="k">object</span><span class="w"> </span><span class="nc">CounterSvc</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">implicit</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">impl</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterSvc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CounterSvc</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<div class="language-scala highlight"><span class="filename">./backend/src/main/modules/counter/CounterRep.scala</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">package</span><span class="w"> </span><span class="nn">modules</span><span class="p">.</span><span class="n">counter</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IO</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">confs</span><span class="p">.</span><span class="nc">DbConf</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">doobie</span><span class="p">.</span><span class="nc">ConnectionIO</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="k">import</span><span class="w"> </span><span class="nn">doobie</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="k">import</span><span class="w"> </span><span class="nn">modules</span><span class="p">.</span><span class="nn">counter</span><span class="p">.</span><span class="nc">CounterMod</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CounterRep</span><span class="p">()(</span><span class="k">implicit</span><span class="w"> </span><span class="n">dbConf</span><span class="p">:</span><span class="w"> </span><span class="nc">DbConf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">getOrCreate</span><span class="p">:</span><span class="w"> </span><span class="nc">ConnectionIO</span><span class="p">[</span><span class="nc">CounterMod</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">createIfNotFound</span><span class="p">(</span><span class="n">counterFound</span><span class="p">:</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">CounterMod</span><span class="p">]):</span><span class="w"> </span><span class="nc">ConnectionIO</span><span class="p">[</span><span class="nc">CounterMod</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counterFound</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">pure</span><span class="p">[</span><span class="nc">ConnectionIO</span><span class="p">]</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="nc">None</span><span class="w">          </span><span class="o">=&gt;</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">        </span><span class="n">sql</span><span class="s">&quot;&quot;&quot;|INSERT INTO counter (count)</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="s">              |VALUES (0);&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span><span class="p">.</span><span class="n">update</span><span class="p">.</span><span class="n">withUniqueGeneratedKeys</span><span class="p">[</span><span class="nc">Long</span><span class="p">](</span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;=</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">          </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">sql</span><span class="s">&quot;&quot;&quot;|SELECT *</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="s">                       |FROM counter</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="s">                       |WHERE id = $id;&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span><span class="p">.</span><span class="n">query</span><span class="p">[</span><span class="nc">CounterMod</span><span class="p">].</span><span class="n">unique</span><span class="p">)</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="w">      </span><span class="n">counterFound</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sql</span><span class="s">&quot;&quot;&quot;|SELECT *</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="s">                            |FROM counter</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="s">                            |WHERE id = 1;&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span><span class="p">.</span><span class="n">query</span><span class="p">[</span><span class="nc">CounterMod</span><span class="p">].</span><span class="n">option</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="w">      </span><span class="n">counter</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createIfNotFound</span><span class="p">(</span><span class="n">counterFound</span><span class="p">)</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="n">counter</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">counter</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterMod</span><span class="p">):</span><span class="w"> </span><span class="nc">ConnectionIO</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a><span class="w">    </span><span class="n">sql</span><span class="s">&quot;&quot;&quot;|UPDATE counter</span>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="s">          |SET count = ${counter.count};&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span><span class="p">.</span><span class="n">update</span><span class="p">.</span><span class="n">run</span><span class="p">.</span><span class="n">void</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="p">}</span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="k">object</span><span class="w"> </span><span class="nc">CounterRep</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">implicit</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">impl</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterRep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CounterRep</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Lastly, the <strong>application entry points</strong>.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/src/main/modules/counter/CounterCtrl.scala</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">package</span><span class="w"> </span><span class="nn">modules</span><span class="p">.</span><span class="n">counter</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IO</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nc">HttpRoutes</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">json</span><span class="p">.</span><span class="nn">circe</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nc">Http4sServerInterpreter</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="k">final</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CounterCtrl</span><span class="p">()(</span><span class="k">implicit</span><span class="w"> </span><span class="n">counterSvc</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterSvc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">endpoints</span><span class="p">:</span><span class="w"> </span><span class="nc">List</span><span class="p">[</span><span class="nc">AnyEndpoint</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span><span class="n">getEpt</span><span class="p">,</span><span class="w"> </span><span class="n">addOneEpt</span><span class="p">)</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">routes</span><span class="p">:</span><span class="w"> </span><span class="nc">HttpRoutes</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">getRts</span><span class="w"> </span><span class="o">&lt;+&gt;</span><span class="w"> </span><span class="n">addOneRts</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">getEpt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endpoint</span><span class="p">.</span><span class="n">summary</span><span class="p">(</span><span class="s">&quot;Get counter&quot;</span><span class="p">).</span><span class="n">get</span><span class="p">.</span><span class="n">in</span><span class="p">(</span><span class="s">&quot;api&quot;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s">&quot;counter&quot;</span><span class="p">).</span><span class="n">out</span><span class="p">(</span><span class="n">jsonBody</span><span class="p">[</span><span class="nc">Long</span><span class="p">])</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">getRts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Http4sServerInterpreter</span><span class="p">[</span><span class="nc">IO</span><span class="p">]().</span><span class="n">toRoutes</span><span class="p">(</span><span class="n">getEpt</span><span class="p">.</span><span class="n">serverLogicSuccess</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">counterSvc</span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">))</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">addOneEpt</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">    </span><span class="n">endpoint</span><span class="p">.</span><span class="n">summary</span><span class="p">(</span><span class="s">&quot;Add one to counter&quot;</span><span class="p">).</span><span class="n">post</span><span class="p">.</span><span class="n">in</span><span class="p">(</span><span class="s">&quot;api&quot;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s">&quot;counter&quot;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s">&quot;add-one&quot;</span><span class="p">).</span><span class="n">out</span><span class="p">(</span><span class="n">jsonBody</span><span class="p">[</span><span class="nc">Long</span><span class="p">])</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">addOneRts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Http4sServerInterpreter</span><span class="p">[</span><span class="nc">IO</span><span class="p">]().</span><span class="n">toRoutes</span><span class="p">(</span><span class="n">addOneEpt</span><span class="p">.</span><span class="n">serverLogicSuccess</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">counterSvc</span><span class="p">.</span><span class="n">addOne</span><span class="p">))</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="p">}</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="k">object</span><span class="w"> </span><span class="nc">CounterCtrl</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">implicit</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">impl</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterCtrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CounterCtrl</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Then, make all these components accessible for the frontend. Let's wrap up by exposing our new endpoints. Let's also move our logger middleware only to application entry points.</p>
<div class="language-scala highlight"><span class="filename">./backend/src/main/scala/confs/ApiConf.scala</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">package</span><span class="w"> </span><span class="n">confs</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IO</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">comcast</span><span class="p">.</span><span class="nn">ip4s</span><span class="p">.</span><span class="nc">IpLiteralSyntax</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">comcast</span><span class="p">.</span><span class="nn">ip4s</span><span class="p">.</span><span class="nc">Port</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="k">import</span><span class="w"> </span><span class="nn">modules</span><span class="p">.</span><span class="nn">counter</span><span class="p">.</span><span class="nc">CounterCtrl</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">ember</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nc">EmberServerBuilder</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">middleware</span><span class="p">.{</span><span class="nc">Logger</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">LoggerMiddleware</span><span class="p">}</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">middleware</span><span class="p">.</span><span class="nc">CORS</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nc">Logger</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nn">slf4j</span><span class="p">.</span><span class="nc">Slf4jLogger</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nn">syntax</span><span class="p">.</span><span class="nc">LoggerInterpolator</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nc">Http4sServerInterpreter</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">swagger</span><span class="p">.</span><span class="nn">bundle</span><span class="p">.</span><span class="nc">SwaggerInterpreter</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="k">final</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApiConf</span><span class="p">()(</span><span class="k">implicit</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">    </span><span class="n">envConf</span><span class="p">:</span><span class="w"> </span><span class="nc">EnvConf</span><span class="p">,</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">    </span><span class="n">counterCtrl</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterCtrl</span><span class="p">,</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="n">logger</span><span class="p">:</span><span class="w"> </span><span class="nc">Logger</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Slf4jLogger</span><span class="p">.</span><span class="n">getLogger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">    </span><span class="n">port</span><span class="w">      </span><span class="o">&lt;-</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">      </span><span class="nc">IO</span><span class="p">.</span><span class="n">fromOption</span><span class="p">(</span><span class="nc">Port</span><span class="p">.</span><span class="n">fromInt</span><span class="p">(</span><span class="n">envConf</span><span class="p">.</span><span class="n">port</span><span class="p">))(</span><span class="k">new</span><span class="w"> </span><span class="nc">RuntimeException</span><span class="p">(</span><span class="s">s&quot;Not processable port number </span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s">.&quot;</span><span class="p">))</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">    </span><span class="n">corsPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CORS</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">withAllowOriginHostCi</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">                   </span><span class="n">envConf</span><span class="p">.</span><span class="n">devMode</span><span class="p">)</span><span class="w"> </span><span class="c1">// Essential for local development setup with an SPA running on a separate port</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">    </span><span class="n">_</span><span class="w">         </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">EmberServerBuilder</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">                   </span><span class="p">.</span><span class="n">default</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">                   </span><span class="p">.</span><span class="n">withHost</span><span class="p">(</span><span class="n">ipv4</span><span class="s">&quot;0.0.0.0&quot;</span><span class="p">)</span><span class="w">                    </span><span class="c1">// Accept connections from any available network interface</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">                   </span><span class="p">.</span><span class="n">withPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="w">                             </span><span class="c1">// On a given port</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">                   </span><span class="p">.</span><span class="n">withHttpApp</span><span class="p">(</span><span class="n">corsPolicy</span><span class="p">(</span><span class="n">allRts</span><span class="p">).</span><span class="n">orNotFound</span><span class="p">)</span><span class="w"> </span><span class="c1">// Link all routes to the backend server</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">                   </span><span class="p">.</span><span class="n">build</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">                   </span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="p">.</span><span class="n">never</span><span class="p">)</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">                   </span><span class="p">.</span><span class="n">start</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">                   </span><span class="p">.</span><span class="n">void</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">()</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">docsEpt</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="hll"><span class="w">    </span><span class="nc">SwaggerInterpreter</span><span class="p">().</span><span class="n">fromEndpoints</span><span class="p">[</span><span class="nc">IO</span><span class="p">](</span><span class="n">counterCtrl</span><span class="p">.</span><span class="n">endpoints</span><span class="p">,</span><span class="w"> </span><span class="c1">// Here&#39;s where the new endpoint definition is added!</span>
</span></span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">                                           </span><span class="s">&quot;Backend ‚Äì TARP Stack ‚õ∫&quot;</span><span class="p">,</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w">                                           </span><span class="s">&quot;1.0&quot;</span><span class="p">)</span>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">allRts</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">loggerMiddleware</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="w">      </span><span class="nc">LoggerMiddleware</span><span class="p">.</span><span class="n">httpRoutes</span><span class="p">(</span><span class="w">                 </span><span class="c1">// To log incoming requests or outgoing responses from the server</span>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="w">        </span><span class="n">logHeaders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a><span class="w">        </span><span class="n">logBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="w">        </span><span class="n">redactHeadersWhen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">envConf</span><span class="p">.</span><span class="n">devMode</span><span class="p">,</span><span class="w"> </span><span class="c1">// Display header values exclusively during development mode</span>
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="w">        </span><span class="n">logAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Some</span><span class="p">((</span><span class="n">msg</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">info</span><span class="s">&quot;$msg&quot;</span><span class="p">)</span>
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="w">      </span><span class="p">)(</span><span class="n">_</span><span class="p">)</span>
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="w">    </span><span class="nc">Http4sServerInterpreter</span><span class="p">[</span><span class="nc">IO</span><span class="p">]().</span><span class="n">toRoutes</span><span class="p">(</span><span class="n">docsEpt</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;+&gt;</span>
</span><span id="__span-15-50"><a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="hll"><span class="w">      </span><span class="n">loggerMiddleware</span><span class="p">(</span><span class="n">counterCtrl</span><span class="p">.</span><span class="n">routes</span><span class="p">)</span><span class="w"> </span><span class="c1">// Here&#39;s where the new endpoint logic is added!</span>
</span></span><span id="__span-15-51"><a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-52"><a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="p">}</span>
</span><span id="__span-15-53"><a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a>
</span><span id="__span-15-54"><a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="k">object</span><span class="w"> </span><span class="nc">ApiConf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">implicit</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">impl</span><span class="p">:</span><span class="w"> </span><span class="nc">ApiConf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApiConf</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Hehe, it's done! Our new two endpoints are available at <a href="http://localhost:8080/docs/">http://localhost:8080/docs/</a> ü§©!</p>
<figure>
  <a class="glightbox" href="../../../../2/image-11.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Endpoint interaction via SwaggerUI" src="../../../../2/image-11.png" /></a>
  <figcaption>Endpoint interaction via SwaggerUI</figcaption>
</figure>
<p>As you can see, it's possible to interact with your endpoints directly via SwaggerUI.</p>
<h3 id="frontend_1">Frontend</h3>
<p>The objective is to interact with the backend. In order to achieve that, let's first add some dependencies:</p>
<ul>
<li>üîÑ <a href="https://tanstack.com/query/latest/docs/framework/react/overview">React Query</a>: To manage asynchronous data fetching, caching, and updating with our backend.</li>
<li>üõú <a href="https://axios-http.com/docs/intro">Axios</a>: For making HTTP requests.</li>
<li>üõ†Ô∏è <a href="https://openapi-ts.pages.dev/">OpenAPI TypeScript</a>: To automatically generate TypeScript schemas from OpenAPI specifications.</li>
</ul>
<div class="language-json highlight"><span class="filename">./frontend/package.json</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;frontend&quot;</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="nt">&quot;private&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;module&quot;</span><span class="p">,</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="nt">&quot;dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vite&quot;</span><span class="p">,</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tsc &amp;&amp; vite build&quot;</span><span class="p">,</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="nt">&quot;lint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0&quot;</span><span class="p">,</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">    </span><span class="nt">&quot;preview&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vite preview&quot;</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">  </span><span class="nt">&quot;dependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="hll"><span class="w">    </span><span class="nt">&quot;@tanstack/react-query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.31.0&quot;</span><span class="p">,</span>
</span></span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="hll"><span class="w">    </span><span class="nt">&quot;axios&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^1.6.8&quot;</span><span class="p">,</span>
</span></span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">    </span><span class="nt">&quot;react&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^18.2.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">    </span><span class="nt">&quot;react-dom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^18.2.0&quot;</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">  </span><span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="nt">&quot;@types/react&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^18.2.79&quot;</span><span class="p">,</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">    </span><span class="nt">&quot;@types/react-dom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^18.2.25&quot;</span><span class="p">,</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">    </span><span class="nt">&quot;@typescript-eslint/eslint-plugin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^7.7.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">    </span><span class="nt">&quot;@typescript-eslint/parser&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^7.7.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">    </span><span class="nt">&quot;@vitejs/plugin-react-swc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^3.6.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">    </span><span class="nt">&quot;eslint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^8.57.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">    </span><span class="nt">&quot;eslint-plugin-react-hooks&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^4.6.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">    </span><span class="nt">&quot;eslint-plugin-react-refresh&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^0.4.6&quot;</span><span class="p">,</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="hll"><span class="w">    </span><span class="nt">&quot;openapi-typescript&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^6.7.5&quot;</span><span class="p">,</span>
</span></span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">    </span><span class="nt">&quot;typescript&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.4.5&quot;</span><span class="p">,</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">    </span><span class="nt">&quot;vite&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.2.10&quot;</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="p">}</span>
</span></code></pre></div>
<p>To install these new dependencies in your <code>./frontend/node_modules/</code> folder, simply run <code>npm update --save</code>. Then, we should define our Axios service, which will interact with the backend.</p>
<div class="language-ts highlight"><span class="filename">./frontend/src/services/backend/index.ts</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;axios&quot;</span><span class="p">;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useBackend</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="nx">baseURL</span><span class="o">:</span><span class="w"> </span><span class="kt">import.meta.env.DEV</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="c1">// During development, the backend is hosted at &#39;localhost:8080&#39;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">backend</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>Now, for something truly magical: automatically generating backend schemas using OpenAPI TypeScript.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>npx<span class="w"> </span>openapi-typescript<span class="w"> </span>http://localhost:8080/docs/docs.yaml<span class="w"> </span>--output<span class="w"> </span>./src/services/backend/endpoints.d.ts
</span></code></pre></div>
<p>A new file should have popped up at <code>./frontend/src/services/backend/endpoints.d.ts</code>, which is <strong>an exact replica of our SwaggerUI but in TypeScript</strong>. In our case, it might not be as impressive, but just imagine in an actual enterprise backend which may contain 20 to 100 endpoints. How many days of work that would take for a frontend team to properly manage the schemas üò£? And seriously, who wants to do a job of just copying SwaggerUI schemas into TypeScript interfaces? Not you? Not me üí©! This library is truly the holy grail üôè! Don't forget to leave a star on their <a href="https://github.com/drwpow/openapi-typescript">GitHub repository</a>!</p>
<p>Alright, now that the backend service is set up, let's dive into some coding, or should I say, let's just re-adapt the code that is already generated by Vite üê∑:</p>
<ul>
<li>First, install üõ£Ô∏è <a href="https://reactrouter.com/en/main">React Router</a>: It manages the frontend routes displayed in the user's browser.</li>
</ul>
<div class="language-json highlight"><span class="filename">./frontend/package.json</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;frontend&quot;</span><span class="p">,</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span><span class="nt">&quot;private&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;module&quot;</span><span class="p">,</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">    </span><span class="nt">&quot;dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vite&quot;</span><span class="p">,</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tsc &amp;&amp; vite build&quot;</span><span class="p">,</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="nt">&quot;lint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0&quot;</span><span class="p">,</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">    </span><span class="nt">&quot;preview&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vite preview&quot;</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">  </span><span class="nt">&quot;dependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">    </span><span class="nt">&quot;@tanstack/react-query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.31.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">    </span><span class="nt">&quot;axios&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^1.6.8&quot;</span><span class="p">,</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">    </span><span class="nt">&quot;react&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^18.2.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">    </span><span class="nt">&quot;react-dom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^18.2.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="hll"><span class="w">    </span><span class="nt">&quot;react-router-dom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^6.22.3&quot;</span>
</span></span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">  </span><span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">    </span><span class="nt">&quot;@types/react&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^18.2.79&quot;</span><span class="p">,</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">    </span><span class="nt">&quot;@types/react-dom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^18.2.25&quot;</span><span class="p">,</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">    </span><span class="nt">&quot;@typescript-eslint/eslint-plugin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^7.7.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">    </span><span class="nt">&quot;@typescript-eslint/parser&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^7.7.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">    </span><span class="nt">&quot;@vitejs/plugin-react-swc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^3.6.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">    </span><span class="nt">&quot;eslint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^8.57.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">    </span><span class="nt">&quot;eslint-plugin-react-hooks&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^4.6.0&quot;</span><span class="p">,</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">    </span><span class="nt">&quot;eslint-plugin-react-refresh&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^0.4.6&quot;</span><span class="p">,</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">    </span><span class="nt">&quot;openapi-typescript&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^6.7.5&quot;</span><span class="p">,</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">    </span><span class="nt">&quot;typescript&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.4.5&quot;</span><span class="p">,</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">    </span><span class="nt">&quot;vite&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.2.10&quot;</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Second, let's re-adapt the existing page as a component. I prefer to separate component <strong>logic, styles, and template</strong>.</li>
</ul>
<div class="language-ts highlight"><span class="filename">./frontend/src/modules/counter/CounterPg/useCounter.ts</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useBackend</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@/services/backend&quot;</span><span class="p">;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">paths</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@/services/backend/endpoints&quot;</span><span class="p">;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useMutation</span><span class="p">,</span><span class="w"> </span><span class="nx">useQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">useQueryClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@tanstack/react-query&quot;</span><span class="p">;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useCounter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">backend</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useBackend</span><span class="p">();</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">queryClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useQueryClient</span><span class="p">();</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">count</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useQuery</span><span class="p">({</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="nx">queryKey</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/api/counter&quot;</span><span class="p">],</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="nx">queryFn</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">      </span><span class="nx">backend</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">        </span><span class="p">.</span><span class="nx">get</span><span class="o">&lt;</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">          </span><span class="nx">paths</span><span class="p">[</span><span class="s2">&quot;/api/counter&quot;</span><span class="p">][</span><span class="s2">&quot;get&quot;</span><span class="p">][</span><span class="s2">&quot;responses&quot;</span><span class="p">][</span><span class="s2">&quot;200&quot;</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">][</span><span class="s2">&quot;application/json&quot;</span><span class="p">]</span><span class="w"> </span><span class="c1">// Type safety using the schema generated from OpenAPI TypeScript</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">        </span><span class="o">&gt;</span><span class="p">(</span><span class="s2">&quot;/api/counter&quot;</span><span class="p">)</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">        </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">mutate</span><span class="o">:</span><span class="w"> </span><span class="kt">addOne</span><span class="p">,</span><span class="w"> </span><span class="nx">isPending</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useMutation</span><span class="p">({</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">    </span><span class="nx">mutationFn</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">      </span><span class="nx">backend</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">        </span><span class="p">.</span><span class="nx">post</span><span class="o">&lt;</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">          </span><span class="nx">paths</span><span class="p">[</span><span class="s2">&quot;/api/counter/add-one&quot;</span><span class="p">][</span><span class="s2">&quot;post&quot;</span><span class="p">][</span><span class="s2">&quot;responses&quot;</span><span class="p">][</span><span class="s2">&quot;200&quot;</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">][</span><span class="s2">&quot;application/json&quot;</span><span class="p">]</span><span class="w"> </span><span class="c1">// Type safety using the schema generated from OpenAPI TypeScript</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">        </span><span class="o">&gt;</span><span class="p">(</span><span class="s2">&quot;/api/counter/add-one&quot;</span><span class="p">)</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">        </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">_</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="w">    </span><span class="nx">onSuccess</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">queryClient</span><span class="p">.</span><span class="nx">setQueryData</span><span class="p">([</span><span class="s2">&quot;/api/counter&quot;</span><span class="p">],</span><span class="w"> </span><span class="nx">data</span><span class="p">),</span><span class="w"> </span><span class="c1">// It refreshes the cached with the new received counter</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="w">    </span><span class="nx">count</span><span class="p">,</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w">    </span><span class="nx">addOne</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">addOne</span><span class="p">(),</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">    </span><span class="nx">isProgressing</span><span class="o">:</span><span class="w"> </span><span class="kt">isLoading</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">isPending</span><span class="p">,</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-css highlight"><span class="filename">./frontend/src/modules/counter/CounterPg/Counter.css</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="p">#</span><span class="nn">root</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">  </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">1280</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">  </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="p">}</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="p">.</span><span class="nc">logo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">  </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="kt">em</span><span class="p">;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mf">1.5</span><span class="kt">em</span><span class="p">;</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">  </span><span class="k">will-change</span><span class="p">:</span><span class="w"> </span><span class="k">filter</span><span class="p">;</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">  </span><span class="k">transition</span><span class="p">:</span><span class="w"> </span><span class="k">filter</span><span class="w"> </span><span class="mi">300</span><span class="kt">ms</span><span class="p">;</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="p">}</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="p">.</span><span class="nc">logo</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">  </span><span class="k">filter</span><span class="p">:</span><span class="w"> </span><span class="nb">drop-shadow</span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="kt">em</span><span class="w"> </span><span class="mh">#646cff</span><span class="n">aa</span><span class="p">);</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="p">}</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="p">.</span><span class="nc">logo</span><span class="p">.</span><span class="nc">react</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">  </span><span class="k">filter</span><span class="p">:</span><span class="w"> </span><span class="nb">drop-shadow</span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="kt">em</span><span class="w"> </span><span class="mh">#61dafb</span><span class="n">aa</span><span class="p">);</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="p">}</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="p">@</span><span class="k">keyframes</span><span class="w"> </span><span class="nt">logo-spin</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">  </span><span class="nt">from</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">    </span><span class="k">transform</span><span class="p">:</span><span class="w"> </span><span class="nb">rotate</span><span class="p">(</span><span class="mi">0</span><span class="kt">deg</span><span class="p">);</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">  </span><span class="nt">to</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">    </span><span class="k">transform</span><span class="p">:</span><span class="w"> </span><span class="nb">rotate</span><span class="p">(</span><span class="mi">360</span><span class="kt">deg</span><span class="p">);</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="p">}</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="p">@</span><span class="k">media</span><span class="w"> </span><span class="o">(</span><span class="nt">prefers-reduced-motion</span><span class="o">:</span><span class="w"> </span><span class="nt">no-preference</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="w">  </span><span class="nt">a</span><span class="p">:</span><span class="nd">nth-of-type</span><span class="o">(</span><span class="nt">2</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">logo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="w">    </span><span class="k">animation</span><span class="p">:</span><span class="w"> </span><span class="n">logo-spin</span><span class="w"> </span><span class="kc">infinite</span><span class="w"> </span><span class="mi">20</span><span class="kt">s</span><span class="w"> </span><span class="kc">linear</span><span class="p">;</span>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="p">}</span>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="p">.</span><span class="nc">card</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a><span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">em</span><span class="p">;</span>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="p">}</span>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>
</span><span id="__span-21-40"><a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="p">.</span><span class="nc">read-the-docs</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-41"><a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#888</span><span class="p">;</span>
</span><span id="__span-21-42"><a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-ts highlight"><span class="filename">./frontend/src/modules/counter/CounterPg/index.tsx</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">viteLogo</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;/vite.svg&quot;</span><span class="p">;</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">import</span><span class="w"> </span><span class="s2">&quot;@/modules/counter/CounterPg/Counter.css&quot;</span><span class="p">;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="k">import</span><span class="w"> </span><span class="nx">reactLogo</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@/assets/react.svg&quot;</span><span class="p">;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useCounter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@/modules/counter/CounterPg/useCounter&quot;</span><span class="p">;</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">CounterPg</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">addOne</span><span class="p">,</span><span class="w"> </span><span class="nx">isProgressing</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCounter</span><span class="p">();</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="o">&lt;&gt;</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">a</span><span class="w"> </span><span class="nx">href</span><span class="o">=</span><span class="s2">&quot;https://vitejs.dev&quot;</span><span class="w"> </span><span class="nx">target</span><span class="o">=</span><span class="s2">&quot;_blank&quot;</span><span class="o">&gt;</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">img</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">viteLogo</span><span class="p">}</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;logo&quot;</span><span class="w"> </span><span class="nx">alt</span><span class="o">=</span><span class="s2">&quot;Vite logo&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/a&gt;</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">a</span><span class="w"> </span><span class="nx">href</span><span class="o">=</span><span class="s2">&quot;https://react.dev&quot;</span><span class="w"> </span><span class="nx">target</span><span class="o">=</span><span class="s2">&quot;_blank&quot;</span><span class="o">&gt;</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">img</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">reactLogo</span><span class="p">}</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;logo react&quot;</span><span class="w"> </span><span class="nx">alt</span><span class="o">=</span><span class="s2">&quot;React logo&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/a&gt;</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="hll"><span class="w">      </span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Frontend</span><span class="w"> </span><span class="err">‚Äì</span><span class="w"> </span><span class="nx">TARP</span><span class="w"> </span><span class="nx">Stack</span><span class="w"> </span><span class="err">‚õ∫</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span></span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;card&quot;</span><span class="o">&gt;</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="hll"><span class="w">        </span><span class="o">&lt;</span><span class="nx">button</span><span class="w"> </span><span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">addOne</span><span class="p">()}</span><span class="w"> </span><span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isProgressing</span><span class="p">}</span><span class="o">&gt;</span>
</span></span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w">          </span><span class="nx">count</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="w">          </span><span class="nx">Edit</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">src</span><span class="o">/</span><span class="nx">App</span><span class="p">.</span><span class="nx">tsx</span><span class="o">&lt;</span><span class="err">/code&gt; and save to test HMR</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="w">      </span><span class="o">&lt;</span><span class="nx">p</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;read-the-docs&quot;</span><span class="o">&gt;</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="w">        </span><span class="nx">Click</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Vite</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">React</span><span class="w"> </span><span class="nx">logos</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">learn</span><span class="w"> </span><span class="nx">more</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="w">      </span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">    </span><span class="o">&lt;</span><span class="err">/&gt;</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="p">}</span>
</span></code></pre></div>
<p>Lastly, let's wrap things up by exposing our new component at <code>/</code>. Also, let's take the time to set up a redirection to <code>/</code> in case of a frontend route not found.</p>
<div class="language-ts highlight"><span class="filename">./frontend/src/App.tsx</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">QueryClientProvider</span><span class="p">,</span><span class="w"> </span><span class="nx">QueryClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@tanstack/react-query&quot;</span><span class="p">;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Routes</span><span class="p">,</span><span class="w"> </span><span class="nx">Route</span><span class="p">,</span><span class="w"> </span><span class="nx">BrowserRouter</span><span class="p">,</span><span class="w"> </span><span class="nx">Navigate</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;react-router-dom&quot;</span><span class="p">;</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">CounterPg</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@/modules/counter/CounterPg&quot;</span><span class="p">;</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span><span class="o">&lt;</span><span class="nx">main</span><span class="o">&gt;</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">      </span><span class="o">&lt;</span><span class="nx">BrowserRouter</span><span class="o">&gt;</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">QueryClientProvider</span><span class="w"> </span><span class="nx">client</span><span class="o">=</span><span class="p">{</span><span class="ow">new</span><span class="w"> </span><span class="nx">QueryClient</span><span class="p">()}</span><span class="o">&gt;</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">          </span><span class="o">&lt;</span><span class="nx">Routes</span><span class="o">&gt;</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">            </span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="nx">element</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">CounterPg</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">            </span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Route</span><span class="w"> </span><span class="nx">path</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="nx">element</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Navigate</span><span class="w"> </span><span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">}</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">          </span><span class="o">&lt;</span><span class="err">/Routes&gt;</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/QueryClientProvider&gt;</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">      </span><span class="o">&lt;</span><span class="err">/BrowserRouter&gt;</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">    </span><span class="o">&lt;</span><span class="err">/main&gt;</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="p">}</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span><span class="p">;</span>
</span></code></pre></div>
<p>If you navigate to <a href="http://localhost:5173/">http://localhost:5173/</a> (ensuring your database and backend are running), you should be able to enjoy your persisted click count! üéâ</p>
<figure>
  <a class="glightbox" href="../../../../2/image-12.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Persisted count" src="../../../../2/image-12.png" /></a>
  <figcaption>Persisted count</figcaption>
</figure>
<p>Are you feeling the power of the FullStack developer rising within you right now üò§? You should, because you've just created <strong>an application from the database to the frontend, going through the backend üòâ!</strong> Even though it's just a simple one, I'm sure you can manage from here üëç. The hard part is always the starting point.</p>
<h2 id="wrapping-up-for-production">üéÅ Wrapping Up For Production</h2>
<p>From the previous section, you should have these three services running and interacting locally:</p>
<ul>
<li>ü¶õ A Tapir backend with 2 exposed endpoints and handling database requests on endpoint invocation ‚ñ∂Ô∏è</li>
<li>‚öõÔ∏è A React frontend consuming the 2 exposed endpoints üíÅ‚Äç‚ôÇÔ∏è</li>
<li>üêò A PostgreSQL database with one table storing the click count ü´°</li>
</ul>
<p>Now, the mission will be to prepare for production using Docker. More precisely, <strong>build a Docker image</strong> for our DevOps team to deploy. The Docker container has to be able to serve our frontend and backend simultaneously. However, currently our Tapir backend and React frontend are running on two different servers. So, I'm going to show you how you can <strong>serve your React SPA using Tapir</strong>.</p>
<figure>
  <a class="glightbox" href="../../../../2/image-13.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="SPA Frontend = Static files for the browser to interpret" src="../../../../2/image-13.png" /></a>
  <figcaption>SPA Frontend = Static files for the browser to interpret</figcaption>
</figure>
<h3 id="serving-react-via-tapir">Serving React via Tapir</h3>
<p>To serve your React SPA via Tapir, there are only 2 steps:</p>
<ul>
<li>Build your React SPA into a distributable üéÅ package.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>npm<span class="w"> </span>run<span class="w"> </span>build
</span></code></pre></div>
<figure>
  <a class="glightbox" href="../../../../2/image-14.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="npm run build" src="../../../../2/image-14.png" /></a>
  <figcaption>npm run build</figcaption>
</figure>
<ul>
<li>Serve this distributable via a Tapir endpoint.</li>
</ul>
<div class="language-scala highlight"><span class="filename">./backend/src/main/scala/confs/ApiConf.scala</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">package</span><span class="w"> </span><span class="n">confs</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">effect</span><span class="p">.</span><span class="nc">IO</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">cats</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">comcast</span><span class="p">.</span><span class="nn">ip4s</span><span class="p">.</span><span class="nc">IpLiteralSyntax</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">comcast</span><span class="p">.</span><span class="nn">ip4s</span><span class="p">.</span><span class="nc">Port</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="k">import</span><span class="w"> </span><span class="nn">modules</span><span class="p">.</span><span class="nn">counter</span><span class="p">.</span><span class="nc">CounterCtrl</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">ember</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nc">EmberServerBuilder</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">middleware</span><span class="p">.{</span><span class="nc">Logger</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">LoggerMiddleware</span><span class="p">}</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">middleware</span><span class="p">.</span><span class="nc">CORS</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nc">Logger</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nn">slf4j</span><span class="p">.</span><span class="nc">Slf4jLogger</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">typelevel</span><span class="p">.</span><span class="nn">log4cats</span><span class="p">.</span><span class="nn">syntax</span><span class="p">.</span><span class="nc">LoggerInterpolator</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="n">emptyInput</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">files</span><span class="p">.</span><span class="nc">FilesOptions</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">files</span><span class="p">.</span><span class="n">staticFilesGetServerEndpoint</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nn">http4s</span><span class="p">.</span><span class="nc">Http4sServerInterpreter</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="k">import</span><span class="w"> </span><span class="nn">sttp</span><span class="p">.</span><span class="nn">tapir</span><span class="p">.</span><span class="nn">swagger</span><span class="p">.</span><span class="nn">bundle</span><span class="p">.</span><span class="nc">SwaggerInterpreter</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="k">final</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApiConf</span><span class="p">()(</span><span class="k">implicit</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">    </span><span class="n">envConf</span><span class="p">:</span><span class="w"> </span><span class="nc">EnvConf</span><span class="p">,</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="w">    </span><span class="n">counterCtrl</span><span class="p">:</span><span class="w"> </span><span class="nc">CounterCtrl</span><span class="p">,</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w">    </span><span class="n">logger</span><span class="p">:</span><span class="w"> </span><span class="nc">Logger</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Slf4jLogger</span><span class="p">.</span><span class="n">getLogger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">:</span><span class="w"> </span><span class="nc">IO</span><span class="p">[</span><span class="nc">Unit</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="w">    </span><span class="n">port</span><span class="w">      </span><span class="o">&lt;-</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="w">      </span><span class="nc">IO</span><span class="p">.</span><span class="n">fromOption</span><span class="p">(</span><span class="nc">Port</span><span class="p">.</span><span class="n">fromInt</span><span class="p">(</span><span class="n">envConf</span><span class="p">.</span><span class="n">port</span><span class="p">))(</span><span class="k">new</span><span class="w"> </span><span class="nc">RuntimeException</span><span class="p">(</span><span class="s">s&quot;Not processable port number </span><span class="si">${</span><span class="n">envConf</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s">.&quot;</span><span class="p">))</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="w">    </span><span class="n">corsPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CORS</span><span class="p">.</span><span class="n">policy</span><span class="p">.</span><span class="n">withAllowOriginHostCi</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="w">                   </span><span class="n">envConf</span><span class="p">.</span><span class="n">devMode</span><span class="p">)</span><span class="w"> </span><span class="c1">// Essential for local development setup with an SPA running on a separate port</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="w">    </span><span class="n">_</span><span class="w">         </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">EmberServerBuilder</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="w">                   </span><span class="p">.</span><span class="n">default</span><span class="p">[</span><span class="nc">IO</span><span class="p">]</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="w">                   </span><span class="p">.</span><span class="n">withHost</span><span class="p">(</span><span class="n">ipv4</span><span class="s">&quot;0.0.0.0&quot;</span><span class="p">)</span><span class="w">                    </span><span class="c1">// Accept connections from any available network interface</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="w">                   </span><span class="p">.</span><span class="n">withPort</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="w">                             </span><span class="c1">// On a given port</span>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w">                   </span><span class="p">.</span><span class="n">withHttpApp</span><span class="p">(</span><span class="n">corsPolicy</span><span class="p">(</span><span class="n">allRts</span><span class="p">).</span><span class="n">orNotFound</span><span class="p">)</span><span class="w"> </span><span class="c1">// Link all routes to the backend server</span>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="w">                   </span><span class="p">.</span><span class="n">build</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="w">                   </span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="p">.</span><span class="n">never</span><span class="p">)</span>
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="w">                   </span><span class="p">.</span><span class="n">start</span>
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a><span class="w">                   </span><span class="p">.</span><span class="n">void</span>
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="p">()</span>
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a>
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a><span class="hll"><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">frontendServerLogic</span><span class="w"> </span><span class="o">=</span>
</span></span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a><span class="hll"><span class="w">    </span><span class="n">staticFilesGetServerEndpoint</span><span class="p">[</span><span class="nc">IO</span><span class="p">](</span><span class="n">emptyInput</span><span class="p">)(</span>
</span></span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a><span class="hll"><span class="w">      </span><span class="s">&quot;../frontend/dist&quot;</span><span class="p">,</span><span class="w">                                  </span><span class="c1">// Serve frontend static files from &#39;../frontend/dist&#39; at &#39;/&#39;</span>
</span></span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="hll"><span class="w">      </span><span class="nc">FilesOptions</span><span class="p">.</span><span class="n">default</span><span class="p">.</span><span class="n">defaultFile</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="s">&quot;index.html&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// Serve &#39;../frontend/dist/index.html&#39; if not found</span>
</span></span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a><span class="hll"><span class="w">    </span><span class="p">)</span>
</span></span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a><span class="hll"><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">frontendEpt</span><span class="w">         </span><span class="o">=</span>
</span></span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a><span class="hll"><span class="w">    </span><span class="n">frontendServerLogic</span><span class="p">.</span><span class="n">endpoint</span><span class="p">.</span><span class="n">summary</span><span class="p">(</span><span class="s">&quot;Frontend served from &#39;../frontend/dist&#39; on the file system&quot;</span><span class="p">)</span>
</span></span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a><span class="hll"><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">frontendRts</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nc">Http4sServerInterpreter</span><span class="p">[</span><span class="nc">IO</span><span class="p">]().</span><span class="n">toRoutes</span><span class="p">(</span><span class="n">frontendServerLogic</span><span class="p">)</span>
</span></span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">docsEpt</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a><span class="w">    </span><span class="nc">SwaggerInterpreter</span><span class="p">().</span><span class="n">fromEndpoints</span><span class="p">[</span><span class="nc">IO</span><span class="p">](</span>
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a><span class="w">      </span><span class="n">counterCtrl</span><span class="p">.</span><span class="n">endpoints</span><span class="w"> </span><span class="o">:+</span><span class="w"> </span><span class="c1">// Here&#39;s where the new endpoint definition is added!</span>
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a><span class="hll"><span class="w">        </span><span class="n">frontendEpt</span><span class="p">,</span>
</span></span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="w">      </span><span class="s">&quot;Backend ‚Äì TARP Stack ‚õ∫&quot;</span><span class="p">,</span>
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a><span class="w">      </span><span class="s">&quot;1.0&quot;</span><span class="p">)</span>
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">allRts</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">loggerMiddleware</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a><span class="w">      </span><span class="nc">LoggerMiddleware</span><span class="p">.</span><span class="n">httpRoutes</span><span class="p">(</span><span class="w">                 </span><span class="c1">// To log incoming requests or outgoing responses from the server</span>
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a><span class="w">        </span><span class="n">logHeaders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-25-59"><a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a><span class="w">        </span><span class="n">logBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-25-60"><a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a><span class="w">        </span><span class="n">redactHeadersWhen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">envConf</span><span class="p">.</span><span class="n">devMode</span><span class="p">,</span><span class="w"> </span><span class="c1">// Display header values exclusively during development mode</span>
</span><span id="__span-25-61"><a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a><span class="w">        </span><span class="n">logAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Some</span><span class="p">((</span><span class="n">msg</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">info</span><span class="s">&quot;$msg&quot;</span><span class="p">)</span>
</span><span id="__span-25-62"><a id="__codelineno-25-62" name="__codelineno-25-62" href="#__codelineno-25-62"></a><span class="w">      </span><span class="p">)(</span><span class="n">_</span><span class="p">)</span>
</span><span id="__span-25-63"><a id="__codelineno-25-63" name="__codelineno-25-63" href="#__codelineno-25-63"></a><span class="w">    </span><span class="nc">Http4sServerInterpreter</span><span class="p">[</span><span class="nc">IO</span><span class="p">]().</span><span class="n">toRoutes</span><span class="p">(</span><span class="n">docsEpt</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;+&gt;</span>
</span><span id="__span-25-64"><a id="__codelineno-25-64" name="__codelineno-25-64" href="#__codelineno-25-64"></a><span class="w">      </span><span class="n">loggerMiddleware</span><span class="p">(</span><span class="n">counterCtrl</span><span class="p">.</span><span class="n">routes</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;+&gt;</span><span class="w"> </span><span class="c1">// Here&#39;s where the new endpoint logic is added!</span>
</span><span id="__span-25-65"><a id="__codelineno-25-65" name="__codelineno-25-65" href="#__codelineno-25-65"></a><span class="hll"><span class="w">      </span><span class="n">frontendRts</span><span class="w"> </span><span class="c1">// Endpoints are resolved by order, so it&#39;s crucial to place frontend logic last! Otherwise, it will always serve &#39;index.html&#39;!</span>
</span></span><span id="__span-25-66"><a id="__codelineno-25-66" name="__codelineno-25-66" href="#__codelineno-25-66"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-67"><a id="__codelineno-25-67" name="__codelineno-25-67" href="#__codelineno-25-67"></a><span class="p">}</span>
</span><span id="__span-25-68"><a id="__codelineno-25-68" name="__codelineno-25-68" href="#__codelineno-25-68"></a>
</span><span id="__span-25-69"><a id="__codelineno-25-69" name="__codelineno-25-69" href="#__codelineno-25-69"></a><span class="k">object</span><span class="w"> </span><span class="nc">ApiConf</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">implicit</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">impl</span><span class="p">:</span><span class="w"> </span><span class="nc">ApiConf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ApiConf</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Then we're done! üëè Already?! Yep, Tapir's <code>staticFilesGetServerEndpoint</code> method did everything for us üòå. If you go to <a href="http://localhost:8080">http://localhost:8080</a> while running only your backend, you should see your frontend being served.</p>
<figure>
  <a class="glightbox" href="../../../../2/image-15.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Serving React via Tapir" src="../../../../2/image-15.png" /></a>
  <figcaption>Serving React via Tapir</figcaption>
</figure>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Two crucial rules to adhere to when serving any frontend SPA application from your custom backend: Firstly, <strong>it's imperative to avoid using <code>/api</code> or any other subpath used by the backend for routing within the frontend</strong>. Secondly, ensure that the backend serves <strong><code>index.html</code> in case of a non-existent endpoint, giving back control of the browser's routing to the frontend</strong>.</p>
</div>
<h3 id="optimized-docker-build">Optimized Docker Build</h3>
<p>Final part! Now onto building the Docker image. It's crucial to aim for a <strong>swift Docker build</strong> and the most <strong>lightweight Docker image</strong> possible. To pursue these goals as effectively as we can üåà, we'll leverage the <a href="https://docs.docker.com/build/cache/">Docker build cache</a> and employ <a href="https://docs.docker.com/build/building/multi-stage/">Multi-stage builds</a>.</p>
<ul>
<li>Regarding the <strong>üóÑÔ∏è Docker build cache</strong>: It's crucial to prioritize your less frequently altered and heaviest <a href="https://docs.docker.com/build/guide/layers/">image layers</a> first, typically those involving dependency installations. By doing so, the <a href="https://docs.docker.com/reference/cli/docker/image/build/">Docker image build</a> process will attempt to utilize cached image layers instead of rebuilding them.</li>
<li>As for the <strong>üèóÔ∏è Multi-stage builds</strong>: Certain image layers are temporary and exist solely for building the application, rather than for running it. Multi-stage builds offer a means to eliminate these unnecessary image layers from our final Docker image.</li>
</ul>
<p>Here are the <a href="https://docs.docker.com/build/building/context/#dockerignore-files"><code>.dockerignore</code></a> and <a href="https://docs.docker.com/reference/dockerfile/"><code>Dockerfile</code></a> files.</p>
<div class="language-text highlight"><span class="filename">./devops/prod-build/Dockerfile.dockerignore</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a># Backend
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>/backend/**/.bloop/
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>/backend/.metals/
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>/backend/.vscode/
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>/backend/**/target/
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>/backend/**/metals.sbt
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>/backend/src/test/
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>/backend/.gitignore
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>/backend/.scalafmt.conf
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>/backend/README.md
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a># Frontend
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>/frontend/.vscode
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>/frontend/dist/
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>/frontend/node_modules/
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>/frontend/.eslintrc.cjs
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>/frontend/.gitignore
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>/frontend/README.md
</span></code></pre></div>
<div class="language-dockerfile highlight"><span class="filename">./devops/prod-build/Dockerfile</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">eclipse-temurin:17.0.10_7-jre</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">backend_builder</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/build/backend</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="c"># Start SBT install via Coursier: https://www.scala-sbt.org/1.x/docs/Installing-sbt-on-Linux.html</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="k">RUN</span><span class="w"> </span>curl<span class="w"> </span>-fLo<span class="w"> </span>coursier<span class="w"> </span>https://github.com/coursier/launchers/raw/master/coursier<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>coursier<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>./coursier<span class="w"> </span>setup<span class="w"> </span>-y
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="c"># End</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="k">COPY</span><span class="w"> </span>backend/project<span class="w"> </span>/build/backend/project
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="k">COPY</span><span class="w"> </span>backend/build.sbt<span class="w"> </span>/build/backend/
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="k">RUN</span><span class="w"> </span>/root/.local/share/coursier/bin/sbt<span class="w"> </span>update
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="k">COPY</span><span class="w"> </span>backend<span class="w"> </span>/build/backend
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="k">RUN</span><span class="w"> </span>/root/.local/share/coursier/bin/sbt<span class="w"> </span>package<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>dist<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>/root/.local/share/coursier/bin/sbt<span class="w"> </span><span class="s2">&quot;export Runtime / fullClasspathAsJars&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s2">&quot;:&quot;</span><span class="w"> </span><span class="s2">&quot;\n&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-I<span class="w"> </span><span class="s1">&#39;{}&#39;</span><span class="w"> </span>mv<span class="w"> </span><span class="s1">&#39;{}&#39;</span><span class="w"> </span>/build/backend/dist
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:20.12-slim</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">frontend_builder</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/build/frontend</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="k">COPY</span><span class="w"> </span>frontend/package.json<span class="w"> </span>frontend/package-lock.json<span class="w"> </span>/build/frontend/
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>install
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="k">COPY</span><span class="w"> </span>frontend<span class="w"> </span>/build/frontend
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>build
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="k">FROM</span><span class="w"> </span><span class="s">eclipse-temurin:17.0.10_7-jre</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app/backend</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>backend_builder<span class="w"> </span>/build/backend/dist<span class="w"> </span>/app/backend/dist
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>frontend_builder<span class="w"> </span>/build/frontend/dist<span class="w"> </span>/app/frontend/dist
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">TARP_DEV_MODE</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;java&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-cp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/app/backend/dist/*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Main&quot;</span><span class="w"> </span><span class="p">]</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To build your final Docker image, ensure to utilize <a href="https://docs.docker.com/reference/cli/docker/buildx/">docker buildx</a> to render your image compatible with two processor architectures - <strong>amd64</strong> and <strong>arm64</strong>. Why, you may ask? Well, according to the <a href="https://survey.stackoverflow.co/2023/#section-most-popular-technologies-operating-system">Stack Oveflow Survey 2023</a>, the most commonly used operating systems among developers are <strong>Windows, MacOS, and Ubuntu</strong>, which frequently implies the presence of <strong>amd64</strong> and <strong>arm64</strong> processor architectures.</p>
</div>
<p>To build and push your <strong>multi-architecture compatible Docker image to the registry</strong>, execute the following two commands:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>create<span class="w"> </span>--use<span class="w"> </span>--name<span class="w"> </span>multi-platform-builder
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my_registry_to_replace/tarp:0.0.0<span class="w"> </span>-t<span class="w"> </span>my_registry_to_replace/tarp:latest<span class="w"> </span>--platform<span class="w"> </span>linux/amd64,linux/arm64<span class="w"> </span>--push<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;prod-build/Dockerfile&quot;</span><span class="w"> </span>..
</span></code></pre></div>
<p>Here are two commands I often use for implementing and debugging the Dockerfile:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my_registry_to_replace/tarp:local<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;prod-build/Dockerfile&quot;</span><span class="w"> </span>..
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--entrypoint<span class="w"> </span>/bin/sh<span class="w"> </span>my_registry_to_replace/tarp:local
</span></code></pre></div>
<p>After the execution is complete, if you navigate to your Docker registry, you should be able to see your images.</p>
<figure>
  <a class="glightbox" href="../../../../2/image-16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Deployable Docker images" src="../../../../2/image-16.png" /></a>
  <figcaption>Deployable Docker images</figcaption>
</figure>
<p>Mission accomplished! üéä</p>
<h2 id="full-stack-developer-reached">üåü Full-Stack Developer Reached!</h2>
<p>If you've reached this conclusion, big congratulations! üéâ You are now a fellow <strong>FullStack developer, master of the TARP stack</strong> üòé. Know this, the fun is only just beginning because you now have the superpower to build your own application üòØ! If you do, please don't hesitate to share it. I am extremely curious to know!</p>
<p>I write monthly on the <a href="https://lovindata.github.io/blog/">LovinData Blog</a> and on <a href="https://medium.com/@jamesjg">Medium</a>, and like to give back the knowledge I've learned. So don't hesitate to reach out; I'm always available to chat about nerdy stuff ü§ó! Here are my socials: <a href="https://www.linkedin.com/in/james-jiang-87306b155/">LinkedIn</a>, <a href="https://twitter.com/jamesjg_">Twitter</a> and <a href="https://www.reddit.com/user/lovindata/">Reddit</a>. Otherwise, let's learn together in the next story ü´°! Bye ‚ù§Ô∏è.</p>







  
  



  


  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; <script>document.write(new Date().getFullYear())</script> James Jiang
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/lovindata" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/user/jamesjg/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/repositories/lovindata" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/jamesjg_" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/james-jiang-87306b155/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.reddit.com/user/lovindata/" target="_blank" rel="noopener" title="www.reddit.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 256C0 114.6 114.6 0 256 0s256 114.6 256 256-114.6 256-256 256H37.1c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256m349.6-102.4c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34-34.5 3.7-61.4 33-61.4 68.4v.2c-37.5 1.6-71.8 12.3-99 29.1-10.1-7.8-22.8-12.5-36.5-12.5-33 0-59.8 26.8-59.8 59.8 0 24 14.1 44.6 34.4 54.1 2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54 0-33-26.8-59.8-59.8-59.8-13.7 0-26.3 4.6-36.4 12.4-27.4-17-62.1-27.7-100-29.1v-.2c0-25.4 18.9-46.5 43.4-49.9 4.4 18.8 21.3 32.8 41.5 32.8zm-172.5 93.3c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6-31.4-8.8-30.4-30.5S160.3 247 177 247zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6 11.8-39.3 28.5-39.3 31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9.8-6.2 3.9-6.5 18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1.3 5.1 3.6 3.9 6.5"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://medium.com/@jamesjg" target="_blank" rel="noopener" title="medium.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262m288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tracking", "navigation.tabs", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>